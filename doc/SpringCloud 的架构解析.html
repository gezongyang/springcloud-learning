<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307474 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1963"/>

<div>
<span><div><br/></div><div><span style="font-size: 16pt;">SpringCloud 的架构解析</span></div><div><br/></div><div><br/></div><div>[SpringCloud的中文参考资料]: <a href="https://springcloud.cc/spring-cloud-netflix.html">https://springcloud.cc/spring-cloud-netflix.html</a></div><div>[SpringCloud的中文API]: <a href="https://springcloud.cc/spring-cloud-dalston.html">https://springcloud.cc/spring-cloud-dalston.html</a></div><div>[SpringCloud中国社区]: <a href="http://springcloud.cn/">http://springcloud.cn/</a></div><div>[SpringCloud中文网]: <a href="https://springcloud.cc/">https://springcloud.cc/</a></div><div><br/></div><div>Spring的三大模块：SpringBoot（构建），Spring Cloud（协调），Spring Cloud Data Flow（连接）</div><div><br/></div><div><span style="font-weight: bold;">1.SpringCloud是什么？</span></div><div><br/></div><div>分布式系统的简化版（官方介绍）</div><div>SpringCloud基于SpringBoot提供了一整套微服务的解决方案，包括服务注册与发现，配置中心，全链路监控，服务网关，负载均衡，熔断器等组件，</div><div>除了基于Netflix的开源组件做高度抽象封装之外，还有一些选型中立的开源组件</div><div><br/></div><div> SpringCloud利用SpringBoot的开发便利性巧妙地简化了分布式系统的基础设施开发，SpringCloud为开发人员提供了快速构建分布式系统的一些工具，</div><div>包括配置管理、服务发现、断路器、路由、微代理、事件总线，全局所、决策精选、分布式会话等等，他们都可以用SpringBoot的开发风格做到一键启动和部署。</div><div><span style="font-weight: bold;">一句话概括：SpringCloud是分布式微服务架构下的一站式解决方案，是各个微服务架构落地技术的几何体，俗称微服务全家桶</span></div><div><br/></div><div><span style="font-weight: bold;">2.SpringCloud和SpringBoot的关系</span></div><div><br/></div><div>SpringBoot：专注于快速方便的开发单个个体微服务（关注微观）</div><div><br/></div><div>SpringCloud：关注全局的微服务协调治理框架，将SpringBoot开发的一个个单体微服务组合并管理起来（关注宏观）</div><div><br/></div><div>SpringBoot可以离开SpringCloud独立使用，但是SpringCloud不可以离开SpringBoot，属于依赖关系</div><div><br/></div><div><span style="font-weight: bold;">3.构建SpringCloud工程</span></div><div>概述：SpringCloud工程由一个父工程和若干个Module组成</div><div><br/></div><div>应该遵循的条件：约定 &gt; 配置 &gt; 编码</div><div>RestTemplate类</div><div> 介绍</div><div>RestTemplate是Spring提供的用于访问Rest服务的客户端模板工具集，提供了多种远程访问Http的方法</div><div><br/></div><div>[RestTemplate的API]: <a href="https://docs.spring.io/spring/docs/5.0.6.RELEASE/javadoc-api/">https://docs.spring.io/spring/docs/5.0.6.RELEASE/javadoc-api/</a></div><div><br/></div><div>在一些不涉及实现方法的模块中（消费者），只需要调用其他服务暴露出的接口即可满足的需求，使用RestTemplate类中的方法可以发出需要的HTTP请求并得到返回结果。（类似Ajax）</div><div><br/></div><div> RestTemplate用法：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">RestTemplate restTemplate = new RestTemplate();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//url:请求地址</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//requestMap:请求参数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//type.class:HTTP响应转换成的对象类型</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">restTemplate.getForObject(url,type.class);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">restTemplate.postForObject(url,requestMap,type.class);</span></div></div><div><br/></div><div>构建父工程</div><div>创建一个Maven父工程并命名GAV</div><div>打包方式为==POM==</div><div>在pom.xml中定义各依赖的版本号（若Module中pom.xml的依赖没有指定版本号，则会根据父工程的版本号加入依赖）</div><div> 加入通用的依赖和插件</div><div><br/></div><div>构建Module</div><div>在父工程下新建Maven的Module，打包方式为jar</div><div>一般来时GAV中 GV随父工程，自己定义A即可</div><div>在该Module下pom.xml中加入其它需要的依赖</div><div>正常开发即可</div><div>完成后先clean一下Maven项目，然后再install提供给其它模块调用</div><div><br/></div><div> 添加其它Module的依赖方法</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependencies&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;com.lzl&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;microservice-api&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;version&gt;${project.version}&lt;/version&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/dependencies&gt;</span></div></div><div><br/></div><div>配置该module下的yml</div><div>微服务需要独立的端口</div><div>微服务最重要的是取名字！！！！一定要给微服务配置一个名字！这个名字就是这个微服务对外暴露的名字！</div><div>配置该模块下的其它相关配置（如本例配置了mybatis）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 8001</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mybatis:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  config-location: classpath:mybatis/mybatis.cfg.xml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  type-aliases-package: com.XXX.entity</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  mapper-locations:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  - classpath:mybatis/mapper/**/*.xml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud-dept   #为这个服务取名，非常重要！！！！！</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  datasource:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    type: com.alibaba.druid.pool.DruidDataSource</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    driver-class-name: org.gjt.mm.mysql.Driver</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    url: jdbc:</span><a href="mysql://localhost:3306/cloudDB01" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysql://localhost:3306/cloudDB01</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    username: root</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    password: 123456</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    dbcp2:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      min-idle: 5         #最小连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      initial-size: 5    #初始化连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-total: 10      #最大连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-wait-millis: 200    #等待连接最长的超时时间</span></div></div><div><br/></div><div>编写主启动类</div><div>记得主启动类放在根包下,com.xxx.xxx</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">package com.XXX;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.springframework.boot.SpringApplication;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.springframework.boot.autoconfigure.SpringBootApplication;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Provider8001_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Provider8001_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>SpringCloud添加组件的基本套路</div><div><br/></div><div>1. 新增这个组件的maven坐标GAV</div><div>2. 在启动类上面标注启动该组件（一般来说是@EnableXXXXX）</div><div>3. 编写业务逻辑代码</div><div><br/></div><div>Eureka服务注册与发现</div><div><br/></div><div>Eureka介绍及原理</div><div><br/></div><div>理解</div><div><br/></div><div>Eureka就像一个物业管理公司，其他微服务就像小区的住户，每个住户入住时都要向物业管理公司注册，并定时向物业公司交管理费</div><div><br/></div><div>介绍</div><div>Eureka是一个基于REST的服务，用于定位服务，以实现云端中间层服务发现和故障转移。</div><div>Eureka主管服务注册与发现，在微服务中，以后了这两者，只需要使用服务的标识符（==就是那个在每个服务的yml文件中取得服务名称==），就可以访问到服务，不需要修改服务调用的配置文件</div><div>Eureka遵循AP原则（高可用，分区容错性），因为使用了自我保护机制所以保证了高可用</div><div><br/></div><div>原理：</div><div><br/></div><div>Eureka使用的是C-S结构（客户端-服务端）</div><div>两大组件：Eureka Server（提供注册服务）、 Eureka Client（JAVA客户端，负责发送心跳）</div><div>系统中的其他微服务使用Eureka客户端连接到Eureka服务端维持心跳连接（即注册）。SpringCloud的其他模块可以通过Eureka Server 来发现系统中的微服务并加以调用</div><div><br/></div><div>架构图：</div><div><img src="SpringCloud 的架构解析_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>Eureka服务注册中心构建</div><div><br/></div><div> 加入服务端依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div></div><div><br/></div><div><br/></div><div>配置yml</div><div><br/></div><div>理解：物业公司肯定不向自己注册自己，并肯定知道自己在哪，不用参加检索</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 7001</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    hostname: localhost</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    register-with-eureka: false     #false表示不向注册中心注册自己</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    fetch-registry: false           #false表示自己就是注册中心，职责是维护实例，不参加检索</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/    #设置eureka server的交互地址，即对外暴露的地址</span></div></div><div><br/></div><div>添加启动类</div><div><br/></div><div>注意：要在类前加@EnableEurekaServer标注</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">package com.XXX;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.springframework.boot.SpringApplication;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.springframework.boot.autoconfigure.SpringBootApplication;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://org.springframework.cloud.netflix.eureka.server.enableeurekaserver;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</a></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableEurekaServer</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Eureka7001_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Eureka7001_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>验证是否构建成功</div><div><br/></div><div>启动主程序，访问该服务地址即可</div><div><br/></div><div>向Eureka注册中心注册微服务</div><div><br/></div><div>增加依赖</div><div><br/></div><div>在要注册的微服务的pom.xml文件中增加依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;    </span></div></div><div>       </div><div>修改yml</div><div>在application.yml中增加以内容，将客户端注册到服务列表内</div><div>理解：小区用户要找到物业管理处的地址进行注册</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://localhost:7001/eureka" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://localhost:7001/eureka</a></div></div><div><br/></div><div>主启动类增加注解</div><div><br/></div><div> 增加@EnableEurekaClient注解</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableEurekaClient</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Provider8001_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Provider8001_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>actuator与微服务注册完善</div><div><br/></div><div>#### 主机名称与服务名称的修改</div><div><br/></div><div>修改服务名称，在yml中eureka节点下添加如下内容</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    instance-id: dept8001        #修改别名</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    prefer-ip-address: true        #显示IP地址</span></div></div><div><br/></div><div> info内容的详细信息修改</div><div> 作用</div><div>在查看Eureka时点击进入某个微服务的info时，能给查看者一些必要的信息，可以帮助查看者快速的了解该微服务，开发中十分有意义。</div><div>修改方法：</div><div><br/></div><div>当前工程添加依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br/></div><div>总的父工程的build节点下添加如下内容</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;build&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;finalName&gt;microservicecloud&lt;/finalName&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;resources&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;resource&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                 &lt;!--允许扫描该路径下的资源文件--&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;filtering&gt;true&lt;/filtering&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;/resource&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/resources&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;plugins&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;plugin&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;configuration&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;delimiters&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                         &lt;!--指定动态获取以$标志开头结尾的信息--&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;delimit&gt;$&lt;/delimit&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    &lt;/delimiters&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;/configuration&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;/plugin&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/plugins&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/build&gt;</span></div></div><div><br/></div><div>3. 在当前工程的application.yml文件添加回显信息</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">info:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  author: XXX</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  build-version: $project.version$</span></div></div><div><br/></div><div>Eureka的自我保护</div><div><br/></div><div> 介绍</div><div><br/></div><div>Eureka的自我保护机制主要是为了网络异常时保持高可用设计的，当在Eureka中注册的微服务超过设定是时间内（默认90秒）没有向Eureka服务端发送心跳，该微服务会进入自我保护模式。在自我保护模式中，Eureka会保护服务注册表中的信息，不会注销任何服务实例，直至收到的心跳数恢复至阈值以上，该微服务退出自我保护模式。</div><div><br/></div><div>理解</div><div><br/></div><div>好死不如赖活：Eureka的设计哲学是宁可保留错误的服务信息，也不盲目注销可能健康的服务。所以异常的服务不会被注销，而是进入了自我保护模式。</div><div><br/></div><div> 自我保护模式的开关</div><div><br/></div><div>在Eureka Server模块下的yml文件中添加配置信息即可，true表示打开自我保护模式；false表示关闭自我保护模式（不推荐）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    enable-self-preservation: false</span></div></div><div><br/></div><div> Eureka的服务发现</div><div><br/></div><div> 介绍</div><div>系统中的微服务可以通过Eureka的服务发现去获得在Eureka中注册的服务的信息，这是一个对外暴露的接口。</div><div><br/></div><div> 使用方法（provider中）</div><div>1. 注入DiscoveryClient 对象（spring包下的），在controller方法中获取</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Autowired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">private DiscoveryClient discoveryClient;    </span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@ResponseBody</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@GetMapping(&quot;/provider/discovery&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public Object discovery(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        List&lt;String&gt; list = discoveryClient.getServices();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(list);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        List&lt;ServiceInstance&gt; insList = discoveryClient.getInstances(&quot;MICROSERVICECLOUD-DEPT&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        for (ServiceInstance si:insList) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            System.out.println(si.getHost() +&quot;,&quot; + si.getServiceId() +&quot;,&quot; +si.getPort() +&quot;,&quot; +si.getUri() +&quot;,&quot; +si.getMetadata());</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return this.discoveryClient;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div>2. 在主启动类中加入@EnableDiscoveryClient注解</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableEurekaClient</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableDiscoveryClient</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Provider8001_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Provider8001_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>使用方法（consumer中）</div><div><br/></div><div>在controller方法中使用restTemplate对象调用provider中暴露的URL 并获得返回对象即可</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@GetMapping(&quot;/discovery&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public Object discovery() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return restTemplate.getForObject(URL_PREFIX+&quot;/provider/discovery&quot;,Object.class);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div><br/></div><div>Eureka的集群配置</div><div><br/></div><div>实现集群</div><div><br/></div><div>1. 新建N个Eureka Server模块</div><div>2. 每个模块的pom.xml中加入与单个Eureka Server相同的依赖</div><div>3. 每个模块加入主程序（记得加@EnableEurekaServer注解）</div><div>4. 修改hosts文件（Win7的路径是C:\Windows\System32\drivers\etc）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">127.0.0.1</span> <a href="http://eureka7001.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka7001.com</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">127.0.0.1</span> <a href="http://eureka7002.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka7002.com</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">127.0.0.1</span> <a href="http://eureka7003.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka7003.com</a></div></div><div><br/></div><div>5. 修改Eureka Server模块的application.yml文件，加入集群，主要修改两个地方：</div><div><br/></div><div>hostname：修改为hosts文件中映射的地址</div><div>service-url下的defaultZone节点：填入集群中另外的server服务端的地址</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 7001</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    hostname:</span> <a href="http://eureka7001.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka7001.com</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    #hostname为hosts文件中映射的地址</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    register-with-eureka: false     #false表示不向注册中心注册自己</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    fetch-registry: false           #false表示自己就是注册中心，职责是维护实例，不参加检索</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      #defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/    #设置eureka server的交互地址</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  #其他两个服务端的地址</span></div></div><div><br/></div><div>6. 修改Eureka Client模块的application.yml文件，使其向集群注册服务</div><div><br/></div><div> service-url下的defaultZone节点：填入集群中需要向其注册server服务端的地址</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka</a></div></div><div><br/></div><div>7. 访问地址</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><a href="http://eureka7001.com:7001/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001</a></div><div><a href="http://eureka7002.com:7002/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7002.com:7002</a></div><div><a href="http://eureka7003.com:7003/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7003.com:7003</a></div></div><div><br/></div><div>8.  注：defaultZone中eureka/后缀是必须的，如果删除，Server类不会报错，但是Client注册时会报404错误</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Eureka与Zookeeper对比</span></div><div><br/></div><div>CAP设计原则不同</div><div><br/></div><div>Eureka遵守AP，Zookeeper遵守CP（C：强一致性，A：高可用，P：分区容错性，三者只能选其二，高并发下P必选）</div><div><br/></div><div><img src="SpringCloud 的架构解析_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div> 网络波动下两者的处理对比</div><div><br/></div><div>Zookeeper：</div><div><br/></div><div>当网络出现故障时，剩余zk集群会发起投票选举新的leader，但是此过程会持续30~120s，此过程对于高并发来说十分漫长，会导致整个注册服务的瘫痪，这是不可容忍的</div><div><br/></div><div>Eureka ：</div><div>Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用（保证可用性）。除此之外，Eureka还有一种自我保护机制，如果在15分钟内85%的节点都没有心跳，则注册中心 会认为客户端与之出现了网络故障，则会进入自动保护模式。</div><div>1.Eureka不会移除没有收到心跳的服务；</div><div>2.新的服务仍能在服务端注册，但是暂时不会被同步到其他节点上直到网络稳定</div><div><br/></div><div> 结论</div><div>Eureka可以很好的应对网络故障导致部分节点失去连接的情况，而不会像zookeeper那样导致整个注册服务系统的瘫痪。</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Ribbon负载均衡</span></div><div><br/></div><div>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套客户端负载均衡工具。Ribbon会自动帮助你基于某种规则（简单轮询、随机连接等），也可以实现自定义的负载均衡算法。</div><div><br/></div><div>[Ribbon源码]: <a href="https://github.com/Netflix/Ribbon">https://github.com/Netflix/Ribbon</a></div><div><br/></div><div>负载均衡</div><div><br/></div><div>英文名称：Load Balance，微服务或分布式集群中常用的一种应用</div><div><br/></div><div>简单来说负载均衡就是将用户的请求平摊的分配到多个任务上，从而是系统达到HA（高可用）</div><div>两种负载均衡：</div><div>1. 集中式LB：偏硬件，服务的消费方和提供方之间使用独立的LB设施，由该设施负责把访问请求以某种策略转发至服务的提供方。</div><div>2. 进程内LB：偏软件， 将LB逻辑集成到消费方，消费方从服务注册中心指导哪些地址可用，再自己选择一个合适的服务器。</div><div><br/></div><div>Ribbon初步配置</div><div>Ribbon是客户端负载均衡工具所以应该配置在客户端</div><div><br/></div><div>1. 加入依赖，因为Riboon需要依赖Eureka运行，所以要同时加入Eureka依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div></div><div><br/></div><div>2. 对实现类加入@LoadBalanced注解</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@LoadBalanced</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public RestTemplate getRestTemplate() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return  new RestTemplate();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>3. 在application.yml文件中配置向注册中心注册，如果是作为消费者模块不提供服务，不应该注册自己</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    register-with-eureka: false                #作为消费者不提供服务，不应该注册自己</span></div></div><div><br/></div><div>4. 主启动类中加入@EnableEurekaClient注解</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableEurekaClient</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Consumer80_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Consumer80_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>5. 以上步骤1~4完成后即可在controller中直接通过服务名访问系统中的微服务，服务名作为URI</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">private static final String URL_PREFIX = &quot;</span><a href="http://microservicecloud-dept/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://MICROSERVICECLOUD-DEPT/&quot;;</a></div></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Ribbon负载均衡实现</span></div><div><br/></div><div><span style="font-weight: bold;">架构示意图：</span></div><div><br/></div><div><img src="SpringCloud 的架构解析_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>实现方法</div><div>目标：构建provider集群后consumer通过负载均衡轮询调用在Eureka中注册的服务</div><div><br/></div><div>1. 构建集群，新开两个provider模块，将原provider的代码部分和pom.xml中依赖照搬到新的provider中</div><div>2. 将原provider中application.yml文件照搬到新provider，并修改端口号，若新的provider使用自己的数据库，则修改数据库信息（其他配置也一样，如修改别名）</div><div>3. 集群中服务名称必须一致！</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud-dept   #同一集群下必须使用同一服务名</span></div></div><div><br/></div><div>4. 启动服务，进行测试</div><div><br/></div><div>总结</div><div>Ribbon其实就是一个软负载均衡的客户端组件，可以和其他需要请求的客户端结合使用。</div><div><br/></div><div><span style="font-weight: bold;">Ribbon核心组件IRule</span></div><div>IRule：根据特定算法从服务列表中选取一个需要访问的服务</div><div><br/></div><div>七大方法</div><div>IRule是一个接口，七大方法是其自带的落地实现类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- RoundRobinRule：轮询（默认方法）</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- RandomRule：随机</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- AvailabilityFilteringRule：先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，还有并发的连接数量超过阈值的服务，然后对剩余的服务进行轮询</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- WeightedResponseTimeRule：根据平均响应时间计算服务的权重。统计信息不足时会按照轮询，统计信息足够会按照响应的时间选择服务</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- RetryRule：正常时按照轮询选择服务，若过程中有服务出现故障，在轮询一定次数后依然故障，则会跳过故障的服务继续轮询。</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- BestAvailableRule：先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，然后选择一个并发量最小的服务</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- ZoneAvoidanceRule：默认规则，符合判断server所在的区域的性能和server的可用性选择服务</span></div></div><div><br/></div><div>切换规则方法:</div><div>只需在配置类中配置一个返回具体方法的bean即可</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public IRule MyRule(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new RandomRule();    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div>自定义Ribbon负载均衡算法:</div><div>配置及包位置:</div><div><br/></div><div>1. 自定义的Ribbon算法类不能放在主启动类所在的包及子报下（确切来说是不能放在@ComponentScan注解的包及子包下），否则会被全局应用到Ribbon服务中。应该把自定义算法类放在另外新建的包下，且这个类应该是为==配置类==。（其实与普通切换负载均衡规则类似，只不过是位置不同而已，普通的可以放在主启动类所在的包，自定义的要放在外面的包下）</div><div>2. 主启动类添加@RibbonClient(name = &quot;微服务名&quot;,configuration = XXX.class)注解指定需要用到负载均衡的微服务名及自定义算法的class对象。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableEurekaClient</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@RibbonClient(name = &quot;MICROSERVICECLOUD-DEPT&quot;,configuration = MyRule.class)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Consumer80_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Consumer80_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>通过修改源代码获得自定义算法:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">package com.Rules;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://com.netflix.client.config.iclientconfig;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com.netflix.client.config.IClientConfig;</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://com.netflix.loadbalancer.abstractloadbalancerrule;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com.netflix.loadbalancer.AbstractLoadBalancerRule;</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://com.netflix.loadbalancer.iloadbalancer;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com.netflix.loadbalancer.ILoadBalancer;</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://com.netflix.loadbalancer.roundrobinrule;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com.netflix.loadbalancer.RoundRobinRule;</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://com.netflix.loadbalancer.server;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com.netflix.loadbalancer.Server;</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.slf4j.Logger;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.slf4j.LoggerFactory;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.springframework.context.annotation.Configuration;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import java.util.List;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import java.util.concurrent.atomic.AtomicInteger;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class MyRule extends AbstractLoadBalancerRule {</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private AtomicInteger nextServerCyclicCounter;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static final boolean AVAILABLE_ONLY_SERVERS = true;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static final boolean ALL_SERVERS = false;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private int total = 0;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private int currentIndex = 0;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static Logger log = LoggerFactory.getLogger(RoundRobinRule.class);</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public MyRule() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        nextServerCyclicCounter = new AtomicInteger(0);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public MyRule(ILoadBalancer lb) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        setLoadBalancer(lb);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Server choose(ILoadBalancer lb, Object key) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (lb == null) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            log.warn(&quot;no load balancer&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            return null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Server server = null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        int count = 0;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        while (server == null &amp;&amp; count++ &lt; 10) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            List&lt;Server&gt; reachableServers = lb.getReachableServers();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            List&lt;Server&gt; allServers = lb.getAllServers();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            int upCount = reachableServers.size();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            int serverCount = allServers.size();</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if ((upCount == 0) || (serverCount == 0)) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                log.warn(&quot;No up servers available from load balancer: &quot; + lb);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                return null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if (total &gt; 5) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                total = 0;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                int nextServerIndex = incrementAndGetModulo(serverCount);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                currentIndex = nextServerIndex;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                server = allServers.get(nextServerIndex);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }else {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                if (currentIndex&gt;=serverCount) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    currentIndex = 0;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                server = allServers.get(currentIndex);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                total++;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if (server == null) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                /* Transient. */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                Thread.yield();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                continue;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if (server.isAlive() &amp;&amp; (server.isReadyToServe())) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                return (server);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            // Next.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            server = null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (count &gt;= 10) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            log.warn(&quot;No available alive servers after 10 tries from load balancer: &quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                    + lb);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return server;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * Inspired by the implementation of {@link AtomicInteger#incrementAndGet()}.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     *</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * @param modulo The modulo to bound the value of the counter.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * @return The next value.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private int incrementAndGetModulo(int modulo) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        for (;;) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            int current = nextServerCyclicCounter.get();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            int next = (current + 1) % modulo;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if (</span><a href="http://nextservercycliccounter.compareandset(current/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">nextServerCyclicCounter.compareAndSet(current</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">, next))</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                return next;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Server choose(Object key) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return choose(getLoadBalancer(), key);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void initWithNiwsConfig(IClientConfig clientConfig) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Feign负载均衡:</span></div><div><br/></div><div>Feign是一个声明式WebService客户端，使用方法时定义一个接口并在上面添加注解即可。Feign支持可拔插式的编码器和解码器。Spring Cloud对Feign进行了封装，使其支持SpringMVC和HttpMessageConverters。Feign可以与Eureka和Ribbon组合使用以支持负载均衡。</div><div><br/></div><div>[Feign源码]: <a href="https://github.com/OpenFeign/Feign">https://github.com/OpenFeign/Feign</a></div><div><br/></div><div>使用案例:</div><div>1. 新建Feign模块，加入依赖（其实跟80消费者差不多，主要是多了Feign依赖）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependencies&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;com.XXX&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;microservice-api&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;version&gt;${project.version}&lt;/version&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;!--热部署--&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;springloaded&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/dependencies&gt;</span></div></div><div><br/></div><div>2. <font style="color: rgb(173, 0, 0);">因为Feign开发其实是面向接口编程，所以Feign接口可以放在api模块中供各模块使用，所以要在api模块中添加Feign依赖</font></div><div>3. 在api中编写接口，接口上添加@FeignClient注解，并通过value指定作用的微服务名</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@FeignClient(value = &quot;MICROSERVICECLOUD-DEPT&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public interface DeptClientService {</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @PostMapping(&quot;/dept&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public boolean addDept(Dept dept);</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public List&lt;Dept&gt; findAll();</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept/{id}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Dept findById(@PathVariable(&quot;id&quot;)Integer id);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>4. 在Feign模块中编写Controller，并注入FeignClient接口，直接调用service接口中的方法即可（因为声明Feign接口时已经指定过微服务，所以访问时会正确地找到微服务）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@RestController</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@RequestMapping(&quot;/consumer&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class ConsumerDeptController {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Autowired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private DeptClientService service;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @PostMapping(&quot;/dept&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public boolean addDept(Dept dept){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return service.addDept(dept);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public List&lt;Dept&gt; findAll(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return service.findAll();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept/{id}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Dept findById(@PathVariable(&quot;id&quot;)Integer id){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return service.findById(id);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>5. 修改Feign模块的主启动类，加入@EnableFeignClients注解和@ComponentScan注解（主要是扫描api中声明的接口）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableEurekaClient</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableFeignClients(basePackages = {&quot;com.XXX&quot;})</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@ComponentScan(&quot;com.XXX&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Consumer80Feign_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Consumer80Feign_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>6. 启动后访问，即会按照轮询的方式调用provider集群</div><div>总结</div><div>Feign通过接口方法调用REST服务，在Eureka中查找对应的服务</div><div>Feign集成了Ribbon技术，所以也支持负载均衡（轮询）</div><div><br/></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco; font-weight: bold;">Hystrix断路器</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;">分布式系统面临的问题</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;">扇出</span></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;">多个微服务互相调用的时候，如果A调用B、C，而B、C又继续调用其他微服务，这就是扇出（像一把扇子一样慢慢打开。</span></div><div><br/></div><div><span style="font-weight: bold;">服务雪崩</span></div><div>删除过程中，如果某一个环节的服务出现故障或连接超时，就会导致前面的服务占用越来越多的资源，进而引起系统崩溃，就是“雪崩效应”。</div><div> 对于高流量的应用来说，单一的后端依赖会导致服务器所有的资源都在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。</div><div><br/></div><div>Hystrix介绍</div><div><br/></div><div>Hystrix是一个用于处理分布式系统延迟和容错的开源库。分布式系统中，依赖避免不了调用失败，比如超时，异常等。Hystrix能保证在出现问题的时候，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</div><div>Hystrix类似一个“断路器”，当系统中异常发生时，断路器给调用返回一个符合预期的，可处理的FallBack，这样就可以避免长时间无响应或抛出异常，使故障不能再系统中蔓延，造成雪崩。</div><div><br/></div><div>服务熔断</div><div><br/></div><div>熔断机制的注解是@HystrixCommand</div><div>熔断机制是应对雪崩效应的一种链路保护机制，一般存在于服务端</div><div>当扇出链路的某个服务出现故障或响应超时，会进行服务降级，进而熔断该节点的服务调用，快速返回“错误”的相应信息。</div><div>Hystrix的熔断存在阈值，缺省是5秒内20次调用失败就会触发</div><div><br/></div><div>[Hystrix源码]: <a href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a></div><div><br/></div><div>熔断案例</div><div>1. 构建一个新的provider module（如复制8001module）</div><div>2. pom.xml加入hystrix依赖（一定要配合Eureka）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br style="font-weight: bold;"/></div><div>3. application.yml中配置端口和Eureka信息（必配）和其他框架的配置信息（可选，如mybatis）</div><div>4. 编写具体业务逻辑</div><div>5. controller类中，在需要配置Fallback的方法上加入@@HystrixCommand(fallbackMethod = &quot;XXX&quot;)注解，XXX为FallBack方法名本例中作为测试所以抛出了异常</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   @ResponseBody</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept/{id}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @HystrixCommand(fallbackMethod = &quot;nullDeptFallBack&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Dept findById(@PathVariable(&quot;id&quot;)Integer id) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Dept dept = deptService.findById(id);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (null == dept){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            throw new RuntimeException(&quot;返回值为空！&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return dept;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div><br/></div><div>6. 根据需要配置FallBack的方法返回值编写代码</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public Dept nullDeptFallBack(@PathVariable(&quot;id&quot;)Integer id) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(111);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new Dept().setId(id).setDeptName(&quot;nullName&quot;).setDbSource(&quot;nullDB&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div>7. 主启动类中加入@EnableCircuitBreaker注解</div><div>8. 开启服务，测试</div><div><br/></div><div><span style="font-weight: bold;">解耦与降级处理：</span></div><div><br/></div><div><span style="font-weight: bold;">降级：</span></div><div><br/></div><div>当系统整体资源快不够的时候，忍痛将部分服务暂时关闭，带渡过难关后，再重新开启。</div><div>降级处理时在客户端完成的，与服务端没有关系</div><div> 理解：所谓降级，一般是从整体负荷考虑，当某个服务熔断之后，服务器将不再被调用，此时客户端可以自己准备一个本地的FallBack回调，返回一个缺省值。这样做虽然服务水平下降，但好歹可用，比直接挂掉好。</div><div><br/></div><div>为什么要解耦：</div><div><br/></div><div>如果按照上面的熔断案例来做的话，Controller下的每个方法，都要给其编写一个FallBack方法，当方法慢慢变多，就会造成代码膨胀，一个是增加编写的工作量，另外一个也会增大维护的难度，代码的耦合度也会高，是十分不合理的，所以要将其解耦。</div><div><br/></div><div>解耦思路：</div><div>因为服务端的是通过实现接口访问服务端的，如果在父接口上实现了FallBack方法，通过这样一种方式去维护起来就能实现解耦，也顺便完成了降级的机制。</div><div><br/></div><div>解耦&amp;降级案例</div><div>1. 在api模块中新建实现了FallbackFactory&lt;T&gt;接口的类，其中泛型T就是我们需要维护其FallBack的接口方法，并实现其create方法，在create方法中返回实现了T的对象，使用匿名内部类实现T。</div><div>注意：</div><div>这个类一定要加@Component注解！</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import com.XXX.entity.Dept;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import feign.hystrix.FallbackFactory;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import</span> <a href="http://org.springframework.stereotype.component;/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">org.springframework.stereotype.Component;</a></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import java.util.List;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Component</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class DeptClientServiceFallBackFactory implements FallbackFactory&lt;DeptClientService&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public DeptClientService create(Throwable throwable) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new DeptClientService() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            public boolean addDept(Dept dept) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                return false;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            public List&lt;Dept&gt; findAll() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                return null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            public Dept findById(Integer id) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                return new Dept().setId(id).setDeptName(&quot;服务器跪了,&quot;).setDbSource(&quot;迟点来吧&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>2. 修改步骤1中传入的泛型T接口，添加@FeignClient(fallbackFactory = T.class)注解</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@FeignClient(value = &quot;MICROSERVICECLOUD-DEPT&quot;,fallbackFactory = DeptClientServiceFallBackFactory.class)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public interface DeptClientService {</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @PostMapping(&quot;/dept&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public boolean addDept(Dept dept);</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public List&lt;Dept&gt; findAll();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/dept/{id}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Dept findById(@PathVariable(&quot;id&quot;)Integer id);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>3. 修改consumer feign模块的application.yml文件，开启hystrix（注：在IDEA中可能没有代码提示，开启的true也没有正常高亮，但好像不需要做额外操作也不影响结果）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">feign:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  hystrix:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    enabled: true</span></div></div><div><br/></div><div>4. 开启服务并测试</div><div><br/></div><div>HystrixDashboard服务监控</div><div>介绍：SpringCloud对Hystrix Dashboard进行了整合，可以对通过Hystrix发起的请求进行准实时统计，并以报表和图形的形式展示给用户（包括每秒执行多少次请求成功和失败等）。</div><div><br/></div><div>配置案例:</div><div>1. 新建HystrixDashboard模块，pom.xml文件加入HystrixDashboard依赖，其他依赖包括Feign，Ribbon，Eureka（可参考80模块的依赖）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br/></div><div>2. application.yml文件中配置端口（如9001）</div><div>3. provider类中确认要加入actuator依赖（此为监控依赖）</div><div>    </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br/></div><div>4. 编写主启动类，上标@EnableHystrixDashboard标注</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableHystrixDashboard</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class DashBoard9001_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(DashBoard9001_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>5. 启动服务进行测试，访问地址：<a href="http://localhost:9001/hystrix">http://localhost:9001/hystrix</a>，（根据配置端口号），看到刺猬表示已经配置好了</div><div>如何监控:</div><div>在dashboard界面中，填入需要监控的服务地址和端口号加上\hystrix.stream和监测间隔即可进入监控。（如<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a></div><div><br/></div><div>监控分析</div><div>七色：进入监控界面后会有其中颜色的数字，其含义可以对应右上角相同颜色的单词表示的状态，其值代表该状态下触发的次数</div><div>一圈：圈的大小代表该服务的流量，圈越大流量越大</div><div>一线：代表监控间隔中，服务被访问的频率的折线图</div><div>通过观察这些就可以在大量的实例中找出故障实例和高压实例进行修复和维护。</div><div><img src="SpringCloud 的架构解析_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><span style="font-size: 9pt;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco; font-weight: bold;">Zuul路由网关</span></span></div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">概述</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">1. 代理：Zuul提供外部的请求转发到具体的微服务实例中的服务</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">2. 路由：Zuul可以对外部访问实现统一的入口</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">3. 过滤：Zuul可以对外部访问进行干预，如请求校验、服务聚合等</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">4. Zuul需要配合Eureka使用，需要在Eureka中注册并获得其他微服务的信息</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">5. 理解：Zuul就像大楼的保安，可以请他找人（代理），找的人在外面叫什么名字（路由），准不准你进楼（过滤）。因为保安属于物业公司，所以保安要在物业公司注册，所获得的信息也来源于物业公司（与Eureka的关系）。</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">   [Zuul的源码]:</span> <a href="http://github.com/Netflix/zuul" style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">http://github.com/Netflix/zuul</a></div><div><br/></div><div>基本配置:</div><div>1. 构建新的Zuul模块并在pom.xml中加入依赖（Zuul和Eureka必须同时加入）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div></div><div><br/></div><div>2. 新建application.yml文件并配置（一定要向Eureka注册，因为Zuul本身也是一个微服务）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 9527</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud-zuul   #为这个服务取名，非常重要！！！！！</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    instance-id:</span> <a href="http://zuul.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">zuul.com</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    prefer-ip-address: true</span></div></div><div><br/></div><div>3. 修改hosts文件（非必须，不过能更好看出效果）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">127.0.0.0</span> <a href="http://zuul.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">zuul.com</a></div></div><div><br/></div><div>4. 创建主启动类，并加入@EnableZuulProxy注解</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableZuulProxy</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class Zuul9527_APP {</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(Zuul9527_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>5. 启动测试，访问规则：步骤3中指定映射+端口号+微服务名称+访问路径。</div><div><br/></div><div>例子：<a href="http://zuul.com:9527/microservicecloud-dept/dept">http://zuul.com:9527/microservicecloud-dept/dept</a></div><div><br/></div><div><br/></div><div>路由访问映射规则:</div><div><br/></div><div>服务名映射和统一公共前缀</div><div><br/></div><div>当不向暴露真实的服务名时，可以对服务名进行映射，只需在application.yml中配置即可</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">zuul:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  routes:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      #dept0是可以自定义的只是作为区分，没什么具体意义</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    dept0.serviceId: microservicecloud-dept        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    #路径也是自定义的，支持通配符</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    dept0.path: /dept10/**                        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  #需要隐藏的服务名，可以使用通配符，配置之后通过这个微服务名访问就失效了</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  ignored-services: microservicecloud-*</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  #设置统一公共前缀，设置后访问路径：</span><a href="http://zuul.com:9527/nihao/dept10/dept/3" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://zuul.com:9527/nihao/dept10/dept/3</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  prefix: /nihao            </span></div></div><div><br/></div><div>注：<span style="color: rgb(173, 0, 0);">因为Zuul是针对外部访问管理的，所以配置了隐藏的服务，在系统中其他模块进行服务名访问时依然可以正常运行的，这点可以通过打开consumer模块进行验证!</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">SpringCloud Config 分布式配置中心</span></div><div><br/></div><div>分布式系统面临的配置问题：微服务意味着将单体应用拆分成一个个自服务，这些服务都是要相应的配置信息才能运行，随着系统内微服务数量越来越多，配置信息也不断地增多，所以一套集中式的、动态的配置管理设施是必不可少的。</div><div><br/></div><div>概述</div><div><br/></div><div>SpringCloud Config是一个提供外部集中式配置管理的设施，配置服务器为各种不同的额微服务应用提供了一个中心化的外部</div><div><br/></div><div>配置:</div><div><br/></div><div>SpringCloud Config分为客户端和服务端两部分</div><div>  1. 服务端：分布式配置中心，是一个独立的微服务，用来连接并为客户端提供配置信息，加密/解密信息等访问接口</div><div>  2. 客户端：通过指定的配置中心获取配置资源，cloud推荐用git来存储配置信息 SpringCloud Config解决的问题：</div><div>  1. 集中管理配置文件</div><div>  2. 不同环境不同配置，动态化的配置更新</div><div>  3. 运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，让服务中心统一为服务拉取配置文件</div><div>  4. 当配置发生变动时，服务不需要重启即可感知配置变化并应用</div><div>  5. 将配置信息以REST接口形式暴露</div><div> <img src="SpringCloud 的架构解析_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">SpringCloud Config服务端与Github通讯</span></div><div><br/></div><div><span style="font-weight: bold;">案例</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;!-- springCloud Config --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;!-- 避免Config的Git插件报错：org/eclipse/jgit/api/TransportConfigCallback --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.eclipse.jgit&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;org.eclipse.jgit&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;version&gt;4.10.0.201712302008-r&lt;/version&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br/></div><div>2. 建立远程仓库，并上传配置文件。如下例</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        active:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           - dev</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">---</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles: dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        name: microservicecloud-config-XXX-dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">---</span></div><div><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">spring:</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    profiles: test</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    application:</span></div><div><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">        name: microservicecloud-config-XXX-test</span></div><div><br/></div><div><span style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"># 这个文件必须以UTF-8 来保存</span></div></div><div><br/></div><div><br/></div><div>3. 在application.xml文件中配置github地址</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 3344</span></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    #为这个服务取名，非常重要！！！！！</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud-config</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  cloud:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    config:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        git:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          # uri填github上仓库地址</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          uri:</span> <a href="https://github.com/XXXX/SpringCloud_Configuration.git" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">https://github.com/XXXX/SpringCloud_Configuration.git</a></div></div><div><br/></div><div>4. 编写主启动类，加入@EnableConfigServer注解</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@SpringBootApplication</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@EnableConfigServer</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class ConfigServer3344_APP {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public static void main(String[] args) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        SpringApplication.run(ConfigServer3344_APP.class,args);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>5. 启动服务并尝试访问配置文件，有以下五种访问配置规则</div><div> {application}：配置文件的文件名</div><div> {profile}：读取的环境</div><div> {lable}：分支</div><div><br/></div><div>SHELL</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/{application}/{profile}[/{lable}]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/{application}-{profile}.yml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/{lable}/{application}-{profile}.yml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/{application}-{profile}.properties</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">/{lable}/{application}-{profile}.properties</span></div></div><div><br/></div><div><br/></div><div>可用例子（返回格式可能不大相同，但返回值相同）：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">-</span> <a href="http://config3344.com:3344/application-test.yml" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://config3344.com:3344/application-test.yml</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">-</span> <a href="http://config3344.com:3344/master/application-dev.yml" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://config3344.com:3344/master/application-dev.yml</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">-</span> <a href="http://config3344.com:3344/application-test.yml/master" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://config3344.com:3344/application-test.yml/master</a></div></div><div><br/></div><div><br/></div><div>不可用例子：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; font-family: Monaco;">- 没有该环境，返回空值：</span><a href="http://config3344.com:3344/application-test11.yml/master" style="font-size: 9pt; font-family: Monaco; color: rgb(51, 51, 51);">http://config3344.com:3344/application-test11.yml/master</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">- 没有配置文件，犯回错误页面：</span><a href="http://config3344.com:3344/lkjliiusdfsddsfl.yml" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://config3344.com:3344/lkjliiusdfsddsfl.yml</a></div></div><div><br/></div><div>bootstrap.yml介绍</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">bootstrap.yml比application.yml具有更高的优先级。</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">bootstrap.yml是系统级的资源配置项，application.yml是用户级的资源配置项。</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">SpringCloud会创建&quot;BootStrap Context&quot;作为&quot;ApplicationContext&quot;的父上下文。初始化的时候BootStrap Context负责从外部源加载配置属性并解析。这两个上下文共享一个&quot;Environment&quot;，BootStrap 具有更高优先级，他们不会被本地配置覆盖。</span></div></div><div><br/></div><div>客户端的配置与测试</div><div><br/></div><div>介绍：server服务端获得github配置仓库的地址，进而通过目标配置文件的文件名获取相应的配置，最后将取得的配置对自身资源进行赋值并提供访问</div><div><br/></div><div>实现过程</div><div><br/></div><div>1.创建远程配置yml文件并上传到github上。如下测试案例因为需要进行测试，所以配置了两个profiles方便切换并观察</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        active:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           - dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">---</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    port: 8201</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles: dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        name: microservicecloud-config-client-dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            defaultZone:</span> <a href="http://eureka-dev.com:7001/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka-dev.com:7001/eureka/</a></div><div><br/></div><div>---</div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    port: 8202</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles: test</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        name: microservicecloud-config-client-test</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            defaultZone:</span> <a href="http://eureka-dev.com:7001/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka-dev.com:7001/eureka/</a></div></div><div><br/></div><div><br/></div><div>2. 本地创建config client模块，并配置好pom.xml，以下本组件是必选依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br/></div><div>3. 编写bootstrap.yml配置文件，这个步骤比较关键，主要是根据此处的配置信息去寻找config server以获得github仓库地址和配置中的目标配置文件文件名</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  cloud:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    config:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      name: application_config #需要从github上读取的资源名称，注意没有yml后缀名</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      profile: test   #本次访问的配置项</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      label: master</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      uri:</span> <a href="http://config3344.com:3344/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://config3344.com:3344</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  #本微服务启动后先去找3344号服务，通过SpringCloudConfig获取GitHub的服务地址</span></div></div><div><br/></div><div><span style="font-weight: bold; color: rgb(227, 0, 0);">4. application.yml文件在本module中其实是可写可不写的，为了习惯需要，还是给他写了个名字</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud_config</span></div></div><div><br/></div><div>5. 修改host文件增加映射，和3344一样</div><div>6. 编写主启动类，没什么特别的，最基本的主启动类</div><div>7. 编写controller，此步骤也比较关键，主要是利用@Value注解赋值，若写错了bootstrap.yml中的配置文件名称而没有获取到配置，启动时这里会抛出异常。@Value中注解的参数即是目标配置文件中的参数值，使用El表达式获取</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@org.springframework.web.bind.annotation.RestController</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class RestController {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Value(&quot;${server.port}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private String port;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Value(&quot;${eureka.client.service-url.defaultZone}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private String eurekaZone;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Value(&quot;${spring.application.name}&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private String name;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;/config&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Override</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public String toString() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return &quot;RestController{&quot; +</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &quot;port='&quot; + port + '\'' +</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &quot;, eurekaZone='&quot; + eurekaZone + '\'' +</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &quot;, name='&quot; + name + '\'' +</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                '}';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>8. 先启动config server服务，然后再启用本client服务，根据profiles的值访问对应的端口即可。如本例选择的是test，则访问端口为：<a href="http://config3355.com:8202/config">http://config3355.com:8202/config</a>。（<a href="http://config3355.com/">config3355.com</a>为hosts文件中配置了的映射）</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">SpringCloud的配置实战</span></div><div><br/></div><div>介绍：其实前面client的配置案例都是帮助理解这个组件为主，并没有很大的实际意义。这节的案例中是配置一个Provider，一个eureka，他们的配置统一在github上获取，实现统一配置分布式管理和多环境变更，这个才比较有实战意义。</div><div><br/></div><div>实现过程</div><div>1. 先写好provider和Eureka的配置yml文件，这两个文件和平常配置没什么不同，因为这里主要是说config，所以就没有配置集群，上传yml到github</div><div><br/></div><div>Eureka配置文件示例：</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        active:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           - dev</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles: dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        name: microservicecloud-eureka-client-dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 7001</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    hostname:</span> <a href="http://eureka7001.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka7001.com</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    #hostname为hosts文件中映射的地址</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    register-with-eureka: false     #false表示不向注册中心注册自己</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    fetch-registry: false           #false表示自己就是注册中心，职责是维护实例，不参加检索</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka/</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   #设置eureka server的交互地址</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles: test</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        name: microservicecloud-eureka-client-dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 7001</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    hostname:</span> <a href="http://eureka7001.com/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka7001.com</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    #hostname为hosts文件中映射的地址</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    register-with-eureka: false     #false表示不向注册中心注册自己</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    fetch-registry: false           #false表示自己就是注册中心，职责是维护实例，不参加检索</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka/</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    #设置eureka server的交互地址</span></div></div><div><br/></div><div>Provider配置文件示例：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    profiles:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        active:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">           - dev</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 8001</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mybatis:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  config-location: classpath:mybatis/mybatis.cfg.xml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  type-aliases-package: com.XXX.entity</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  mapper-locations:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  - classpath:mybatis/mapper/**/*.xml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  profiles: dev</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud-dept   #为这个服务取名，非常重要！！！！！</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  datasource:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    type: com.alibaba.druid.pool.DruidDataSource</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    driver-class-name: org.gjt.mm.mysql.Driver</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    url: jdbc:</span><a href="mysql://192.168.88.246:3306/cloudDB01" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysql://192.168.88.246:3306/cloudDB01</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    username: root</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    password: 123456</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    dbcp2:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      min-idle: 5         #最小连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      initial-size: 5    #初始化连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-total: 10      #最大连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-wait-millis: 200  #等待连接最长的超时时间</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka/</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    instance-id: dept8001</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    prefer-ip-address: true</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">server:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  port: 8001</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mybatis:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  config-location: classpath:mybatis/mybatis.cfg.xml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  type-aliases-package: com.XXX.entity</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  mapper-locations:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  - classpath:mybatis/mapper/**/*.xml</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  profiles: test</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud-dept   #为这个服务取名，非常重要！！！！！</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  datasource:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    type: com.alibaba.druid.pool.DruidDataSource</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    driver-class-name: org.gjt.mm.mysql.Driver</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    url: jdbc:</span><a href="mysql://192.168.88.246:3306/cloudDB02" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysql://192.168.88.246:3306/cloudDB02</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    username: root</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    password: 123456</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    dbcp2:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      min-idle: 5         #最小连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      initial-size: 5    #初始化连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-total: 10      #最大连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-wait-millis: 200  #等待连接最长的超时时间</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">eureka:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  client:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    service-url:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      defaultZone:</span> <a href="http://eureka7001.com:7001/eureka/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://eureka7001.com:7001/eureka/</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  instance:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    instance-id: dept8001</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    prefer-ip-address: true</span></div></div><div><br/></div><div>2. 新开eureka和provide的模块并在pom.xml中添加依赖，其他必要依赖和之前的案例一样，但是config的依赖一定要添加上</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/dependency&gt;</span></div></div><div><br/></div><div>3. 两个模块都要编写bootstrap.yml文件，和上面的案例一样</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  cloud:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    config:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      name: application_config #需要从github上读取的资源名称，注意没有yml后缀名</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      profile: test   #本次访问的配置项</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      label: master</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      uri:</span> <a href="http://config3344.com:3344/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://config3344.com:3344</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  #本微服务启动后先去找3344号服务，通过SpringCloudConfig获取GitHub的服务地址</span></div></div><div><br/></div><div>4. (可选)两个模块中编写application.yml文件，可以配置一下服务名</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  application:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name: microservicecloud_config</span></div></div><div><br/></div><div>5. 两个模块的主启动类，Eureka的正常加EurekaServer注解，Provider加EurekaClient注解，不详述</div><div>6. 编写Provider模块的业务代码</div><div>7. 启动测试，因为这两个模块都要通过3344ConfigServer为其在github上获取配置，所以要先启动3344模块，然后再一次启动eureka和provider模块，进行测试即可。</div><div><br/></div><div><img src="SpringCloud 的架构解析_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>这里我们的微服务系统在外部调用时，只能通过网关来访问，系统内的服务可以通过服务名互相访问。</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 